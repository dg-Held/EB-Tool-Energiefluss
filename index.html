<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Energiefluss – Final</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
<style>
 body { font-family: 'Comfortaa', sans-serif; margin: 2cm 0.5cm 1.5cm 2cm; max-width: 17cm; }
 h1, h2 { font-weight: 700; font-size: 16px; }
 label { font-size: 8px; color: #777; display:block; }
 input, select { font-size:12px; width:100%; padding:3px; font-family:'Comfortaa'; }
 input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{ -webkit-appearance:none; margin:0; }
 input[type=range]{ width:100%; }
 .grid5 { display:grid; grid-template-columns: repeat(5,1fr); gap:8px; }
 .grid3 { display:grid; grid-template-columns: 1fr 6cm 1fr; gap:10px; justify-content:center; margin-top:10px; }
 .block { margin-bottom:12px; }
 .bar-bg { width:100%; height:10px; background:#ccc; } .bar-fill{ height:10px; background:#3ABDC4; }
 .bar-fill-loss{ height:10px; background:#E58A8A; }
 .center-graphic{ width:100%; max-width:6cm; height:auto; margin:auto; display:block; }
 .hwb-box{ background:#3ABDC4; color:white; padding:8px; text-align:center; }
 .hwb-values{ display:grid; grid-template-columns: repeat(3,1fr); text-align:center; gap:10px; padding:6px; }
 .print-btn{ margin-top:20px; padding:10px; font-size:14px; }
 @media print { .print-btn{display:none;} }
</style>
</head>
<body>
<h2>Ihr Heizenergiebedarf und die Energieflüsse Ihres Hauses.</h2>

<div class="block">
 <label>Projekttitel</label>
 <input id="proj" type="text" style="font-size:16px;" placeholder="Titel…">
</div>

<div class="grid5">
 <div><label>Straße / HNr.</label><input id="str" type="text"></div>
 <div><label>PLZ</label><input id="plz" type="text"></div>
 <div><label>Ort</label><input id="ort" type="text"></div>
 <div></div>
 <div><label>Anmerkungen</label><input id="anm" type="text"></div>
</div>

<h2>Grunddaten</h2>
<div class="grid5 block">
 <div><label>Wohnnutzfläche (m²)</label><input id="wnf" type="number" value="120"></div>
 <div><label>Beheizt (%)</label><input id="beh" type="range" min="0" max="100" value="90"></div>
 <div><label>BGF (m²)</label><input id="bgf" type="number" readonly></div>
 <div><label>Personen</label><input id="pers" type="number" value="4"></div>
 <div><label>Raumtemperatur (°C)</label><input id="rt" type="number" value="22"></div>
</div>

<div class="grid5 block">
 <div><label>Heizenergie (kWh)</label><input id="hz" type="number" value="25000"></div>
 <div><label>Warmwasser</label><select id="ww"><option value="inkl" selected>inkl.</option><option value="exkl">exkl.</option></select></div>
 <div><label>JNG</label><input id="jng" type="number" step="0.01" value="0.85"></div>
 <div><label>Fensterflächen-Anteil</label><select id="ffa"><option value="niedrig">niedrig</option><option value="mittel" selected>mittel</option><option value="hoch">hoch</option></select></div>
 <div><label>Solare Nutzung</label><select id="sol"><option value="nein" selected>Nein</option><option value="ja">Ja</option></select></div>
</div>

<div class="block" id="solblock" style="display:none;">
 <label>Solare Nutzung (kWh)</label><input id="solkwh" type="number" value="0">
</div>

<div class="grid5 block">
 <div><label>Korrektur Raumwärme</label><input id="krw" readonly></div>
 <div><label>Korrektur beheizte Fläche</label><input id="kbf" readonly></div>
</div>

<h2>Energiefluss im Gebäude</h2>
<div style="display:grid; grid-template-columns: 1fr 6cm 1fr; gap:20px;">

 <!-- Einträge -->
 <div>
   <h3>Einträge</h3>
   <div class="block"><label>PV / Solarthermie (kWh)</label><div id="pv">0</div><div class="bar-bg"><div id="pvb" class="bar-fill"></div></div></div>
   <div class="block"><label>Interne Gewinne (kWh)</label><div id="ig">0</div><div class="bar-bg"><div id="igb" class="bar-fill"></div></div></div>
   <div class="block"><label>Solare Gewinne (kWh)</label><div id="sg">0</div><div class="bar-bg"><div id="sgb" class="bar-fill"></div></div></div>
   <div class="block"><label>Heizenergie (kWh)</label><div id="he">0</div><div class="bar-bg"><div id="heb" class="bar-fill"></div></div></div>
   <div class="block"><strong>Summe:</strong> <span id="sumEin">0</span> kWh<div class="bar-bg"><div id="sumEinB" class="bar-fill" style="width:100%"></div></div></div>
 </div>

 <!-- Grafik -->
 <div><img src="Grafik-Stilisiert.svg" class="center-graphic"></div>

 <!-- Verluste -->
 <div>
   <h3>Verluste</h3>
   <div class="block"><label>Wärmebrücken (kWh)</label><div id="wb">0</div><div class="bar-bg"><div id="wbb" class="bar-fill-loss"></div></div></div>
   <div class="block"><label>Lüftung (kWh)</label><div id="lf">0</div><div class="bar-bg"><div id="lfb" class="bar-fill-loss"></div></div></div>
   <div class="block"><label>Anlage (kWh)</label><div id="anl">0</div><div class="bar-bg"><div id="anlb" class="bar-fill-loss"></div></div></div>
   <div class="block" id="wwlossblock"><label>Warmwasser (kWh)</label><div id="wwl">0</div><div class="bar-bg"><div id="wwlb" class="bar-fill-loss"></div></div></div>
   <div class="block"><label>Bauteile (kWh)</label><div id="bt">0</div><div class="bar-bg"><div id="btb" class="bar-fill-loss"></div></div></div>
   <div class="block"><strong>Summe:</strong> <span id="sumVer">0</span> kWh<div class="bar-bg"><div id="sumVerB" class="bar-fill-loss" style="width:100%"></div></div></div>
 </div>
</div>

<h2>Abschätzung Heizwärmebedarf (HWB)</h2>
<div class="hwb-box">
 <div style="display:grid; grid-template-columns: repeat(3,1fr); gap:10px;">
   <div><strong>HWB<sub>Verbrauch</sub></strong><br><span id="hwbv" style="font-size:18px;">0</span></div>
   <div><strong>Energiebedarf</strong><br><span id="enb">0</span></div>
   <div><strong>BGF</strong><br><span id="bgf2">0</span></div>
 </div>
</div>

<div class="hwb-values">
 <div>HWB<sub>korrigiert</sub>: <span id="hwbk">0</span></div>
 <div>Ziel Raumwärme: 20°C</div>
 <div>Ziel Warmwasser: 55°C</div>
</div>

<button class="print-btn" onclick="window.print()">Drucken</button>
 
<script>
// ------------------------------------------------------
// DOM-Elemente sauber referenzieren (Pflicht ab 2023)
// ------------------------------------------------------
const wnf = document.getElementById("wnf");
const beh = document.getElementById("beh");
const bgf = document.getElementById("bgf");
const pers = document.getElementById("pers");
const rt = document.getElementById("rt");
const hz = document.getElementById("hz");
const jng = document.getElementById("jng");
const ffa = document.getElementById("ffa");
const sol = document.getElementById("sol");
const solkwh = document.getElementById("solkwh");
const solblock = document.getElementById("solblock");

// Einträge
const pv = document.getElementById("pv");
const pvb = document.getElementById("pvb");
const ig = document.getElementById("ig");
const igb = document.getElementById("igb");
const sg = document.getElementById("sg");
const sgb = document.getElementById("sgb");
const he = document.getElementById("he");
const heb = document.getElementById("heb");
const sumEin = document.getElementById("sumEin");
const sumEinB = document.getElementById("sumEinB");

// Verluste
const wb = document.getElementById("wb");
const wbb = document.getElementById("wbb");
const lf = document.getElementById("lf");
const lfb = document.getElementById("lfb");
const anl = document.getElementById("anl");
const anlb = document.getElementById("anlb");
const wwl = document.getElementById("wwl");
const wwlb = document.getElementById("wwlb");
const wwlossblock = document.getElementById("wwlossblock");
const bt = document.getElementById("bt");
const btb = document.getElementById("btb");
const sumVer = document.getElementById("sumVer");
const sumVerB = document.getElementById("sumVerB");

// HWB
const hwbv = document.getElementById("hwbv");
const enb = document.getElementById("enb");
const bgf2 = document.getElementById("bgf2");
const hwbk = document.getElementById("hwbk");

// ------------------------------------------------------
// Hauptberechnung
// ------------------------------------------------------
function calc() {

    // Eingabewerte
    const wnfV = +wnf.value;
    const behV = +beh.value / 100;
    const persV = +pers.value;
    const rtV = +rt.value;
    const hzV = +hz.value;
    const jngV = +jng.value;
    const solUse = sol.value;

    // BGF
    const bg = wnfV * 1.25;
    bgf.value = bg.toFixed(0);
    bgf2.innerHTML = bg.toFixed(0);

    // Korrekturfaktor Raumwärme
    const kr = 1 + ((rtV - 20) * 0.02);
    document.getElementById("krw").value = kr.toFixed(2);

    // Korrektur beheizte Fläche
    const kbfV = behV;
    document.getElementById("kbf").value = kbfV.toFixed(2);

    // ---------------------------
    // Einträge (extrem vereinfachtes Modell)
    // ---------------------------
    const pvV = (solUse === "ja" ? +solkwh.value : 0);
    const igV = persV * 500;
    const sgV = (ffa.value === "hoch" ? 600 : ffa.value === "mittel" ? 400 : 200);
    const heV = hzV * jngV;

    pv.innerHTML = pvV;
    ig.innerHTML = igV;
    sg.innerHTML = sgV;
    he.innerHTML = heV.toFixed(0);

    const sumE = pvV + igV + sgV + heV;
    sumEin.innerHTML = sumE.toFixed(0);

    // ---------------------------
    // Verluste (stark vereinfachtes Modell)
    // ---------------------------
    const wbV = bg * 2.1;
    const lfV = bg * 1.6;
    const anlV = heV * 0.1;
    const btV = bg * 3.2;

    // Warmwasser nur wenn "inkl"
    const wwlV = (document.getElementById("ww").value === "inkl" ? persV * 500 : 0);
    wwlossblock.style.display = (wwlV > 0 ? "block" : "none");

    wb.innerHTML = wbV.toFixed(0);
    lf.innerHTML = lfV.toFixed(0);
    anl.innerHTML = anlV.toFixed(0);
    bt.innerHTML = btV.toFixed(0);
    wwl.innerHTML = wwlV.toFixed(0);

    const sumL = wbV + lfV + anlV + btV + wwlV;
    sumVer.innerHTML = sumL.toFixed(0);

    // ---------------------------
    // Balken skalieren
    // ---------------------------
    function bar(el, value, max) {
        el.style.width = (value / max * 100) + "%";
    }
    const maxEin = Math.max(sumE, 1);
    const maxVer = Math.max(sumL, 1);

    bar(pvb, pvV, maxEin);
    bar(igb, igV, maxEin);
    bar(sgb, sgV, maxEin);
    bar(heb, heV, maxEin);
    bar(sumEinB, sumE, sumE); // Summe = 100 %

    bar(wbb, wbV, maxVer);
    bar(lfb, lfV, maxVer);
    bar(anlb, anlV, maxVer);
    bar(btb, btV, maxVer);
    bar(wwlb, wwlV, maxVer);
    bar(sumVerB, sumVer.innerHTML, sumVer.innerHTML); // Summe = 100 %

    // ---------------------------
    // Heizwärmebedarf
    // ---------------------------
    hwbv.innerHTML = (heV / bg).toFixed(1); // Verbrauch
    enb.innerHTML = (sumE / bg).toFixed(1); // Energiebedarf
    hwbk.innerHTML = (sumL / bg).toFixed(1); // korrigiert
}

// ------------------------------------------------------
// Event-Listener
// ------------------------------------------------------
document.querySelectorAll("input, select").forEach(el => {
    el.addEventListener("input", calc);
});

// Solare Nutzung sichtbar/unsichtbar
sol.addEventListener("change", () => {
    solblock.style.display = (sol.value === "ja" ? "block" : "none");
    calc();
});

// Startberechnung
calc();
</script>
